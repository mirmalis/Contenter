@inherits _Binder<Contenter.Models.Contents.Content>
@rendermode InteractiveServer
@{
  var cultureInfo = new System.Globalization.CultureInfo("lt-LT");
}
@code {
  [Parameter] 
  public bool ShowSources { get; set; } = true;
}
@inject IDialogService dialoger
<EditForm Model=@this.model OnValidSubmit=@this.OnValidSubmit FormName="createContent">
  <DataAnnotationsValidator />
  <FluentValidationSummary />
  <FluentStack Orientation="@Orientation.Vertical">
    <div>
      <FluentTextField @bind-Value=@model.Name Label="Pavadinimas" Style="width:100%;" />
      <div>
        <FluentInputLabel Label="Paskelbimo data" Required />
        <FluentDatePicker Culture="@cultureInfo" 
          Value=@(this.model.PublishedAt)
          ValueChanged=@(val => model.PublishedAt = val)
          ValueExpression=@(() => model.PublishedAt)
          OnCalendarOpen=@(() => {
            if(this.model.PublishedAt == null){
              var now = DateTime.Now;
              this.model.PublishedAt = new DateTime(now.Year, now.Month, now.Day, now.Hour, 0, 0);
            }
          })
        />
        <FluentTimePicker  @bind-Value=@model.PublishedAt @bind-Value:format="MM:hh" />
      </div>
    </div>
    <div>
      Laida 
      @if (this.model.Fam != null)
      {
        <FluentButton OnClick=@(() => this.model.Fam = null)>
          @this.model.Fam
        </FluentButton>
      }
      else
      {
        <ChooseFam 
          value=@this.model.Fam
          valueChanged=@(val => {
            if(val.Id == default) // if new created
            {
            }
            this.model.Fam = val;
          })
          MinTermLength="2"
        > Pasirinkti
        </ChooseFam>
      }
      
    </div>
    <div>
      Svečiai:
      <ChoosePersona MinTermLength="3" value="null" 
        valueChanged=@(val => {
          if(val == null)
            return;
          this.model.GuestPersonaAssignments.Add(
            new() {
              IndexA = this.model.GuestPersonaAssignments.Any() ? this.model.GuestPersonaAssignments.Max(item => item.IndexA) + 1 : 1,
              Guest = val,
              Percentage = 100,
            }
          );
        })
      >Pridėti svečią</ChoosePersona>
      <Listmanager @bind-list=@model.GuestPersonaAssignments Context="ass" >
        <td>@ass.Guest</td>
        <td>
          <FluentNumberField @bind-Value=@ass.Percentage Style="min-width:60px;"/>
        </td>
      </Listmanager>
    </div>
    @if (ChildContent != null)
    {
      <FluentButton Type=@ButtonType.Submit Appearance=@Appearance.Accent>@ChildContent</FluentButton>
    }
  </FluentStack>
</EditForm>
@code {
}
