@inherits _Binder<Contenter.Models.Contents.Content>
@rendermode InteractiveServer
@inject IDialogService dialoger
<EditForm Model=@this.model OnValidSubmit=@this.OnValidSubmit FormName="createContent">
  <DataAnnotationsValidator />
  <FluentValidationSummary />
  <FluentStack Orientation="@Orientation.Vertical">
    <div>
      <FluentTextField @bind-Value=@model.Name Label="Pavadinimas" />
      <div>
        <FluentInputLabel Label="Paskelbimo data" Required />
        <InputDate @bind-Value=@model.PublishedAt />
      </div>
    </div>
    <div>
      Laida (<a href="/c/fam/c">create</a>):
      <div>
        <EFSelect @bind-value=@this.model.Fam />
      </div>
    </div>
    <div>
      Svečiai (<a href="/p/personas/c?BackToContentCreation=true">create</a>):
      <div>
        <EFSelect T="@Contenter.Models.Persons.Persona"
          value=null 
          valueChanged=@(val => {
            if(val == null)
              return;
            this.model.GuestPersonaAssignments.Add(
              new() {
                Index = this.model.GuestPersonaAssignments.Count + 1,
                Guest = val,
                Percentage = 100,
              }
            );
          })
        />
      </div>
      <Listmanager @bind-list=@model.GuestPersonaAssignments Context="ass">
        <td>@ass.Guest</td>
        <td>
          <FluentNumberField @bind-Value=@ass.Percentage Style="min-width:60px;"/>
        </td>
      </Listmanager>
    </div>
    <div>
      Nuorodos:
      <div>
        <EFSelect T=@(Contenter.Models.Sources.SourceDefinition)
                  ParamSource=@(db => db.Set<Contenter.Models.Sources.SourceDefinition>().Include(item => item.Platform))
                  value="@null"
                  valueChanged=@(val => {
                    model.SourceAssignments.Add(
                      new Models.Contents.ContentSources() {
                        Index = model.SourceAssignments.Count + 1,
                        Source = new() {
                          Definition = val
                        }
                      });
                  })
                  >
          <ItemTemplate Context="sd">
            @if (sd != null)
            {
              <Icon ShowPlatformName DefinitionName=@sd.Name iconPath=@sd.Platform.IconPath PlatformName=@sd.Platform.Name PlatformId=@sd.PlatformId>
                ??
              </Icon>
            }
            else
            {
              <text>null</text>
            }
          </ItemTemplate>
        </EFSelect>
        <Listmanager @bind-list=@model.SourceAssignments Context="ass">
          <td><FluentTextField @bind-Value=@ass.Source.Href Style="padding:0px;" /></td>
          <td>
            @if (ass.Source.Definition != null)
            {
              <Icon DefinitionName=@ass.Source.Definition.Name iconPath=@ass.Source.Definition.Platform.IconPath PlatformName=@ass.Source.Definition.Platform.Name PlatformId=@ass.Source.Definition.PlatformId>
                ??
              </Icon>
            }
          </td>
        </Listmanager>
      </div>
    </div>
    @if (ChildContent != null)
    {
      <FluentButton Type=@ButtonType.Submit Appearance=@Appearance.Accent>@ChildContent</FluentButton>
    }
  </FluentStack>
</EditForm>
@code {
}
